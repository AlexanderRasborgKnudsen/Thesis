<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T24U3">xf1</span>] = F_trapz_filter_digital_1(<span class="var type1" id="S3T1U6">D</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="mxinfo " id="T1:U3"><span class="var type1" id="S4T1U9">data</span>=<span class="var type1" id="S3T1U10">D</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T11:U6"><span class="var type1" id="S4T11U13">data</span>=<span class="mxinfo " id="T11:U8"><span class="var type1" id="S4T1U15">data</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S5T2U18">SampleNo</span> = <span class="mxinfo " id="T2:U12">9000</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T7:U13"><span class="var type1" id="S6T7U22">ts</span>=<span class="mxinfo " id="T7:U15">linspace(<span class="mxinfo " id="T2:U16">0</span>,<span class="mxinfo " id="T2:U17"><span class="var type1" id="S5T2U27">SampleNo</span>-1</span>,<span class="var type1" id="S5T2U29">SampleNo</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">[<span class="mxinfo " id="T2:U20"><span class="var type1" id="S8T2U33">Max_val</span></span>,<span class="mxinfo " id="T2:U22"><span class="var type1" id="S9T2U34">Index</span></span>]=max(<span class="var type1" id="S4T11U37">data</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T11:U25"><span class="var type1" id="S11T11U40">expp</span>=<span class="mxinfo " id="T11:U27"><span class="var type1" id="S4T11U42">data</span>(<span class="mxinfo " id="T20:U29"><span class="var type1" id="S9T2U44">Index</span>:<span class="mxinfo " id="T2:U31">end</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T2:U32"><span class="var type1" id="S13T2U49">M</span>=<span class="mxinfo " id="T2:U34">max(<span class="mxinfo " id="T11:U35">find(<span class="mxinfo " id="T18:U36"><span class="var type1" id="S11T11U55">expp</span>&gt;=<span class="mxinfo " id="T2:U38"><span class="var type1" id="S8T2U57">Max_val</span>*<span class="mxinfo " id="T2:U40">0.3678</span></span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="autoExtrinsicFcn" id="F60N3:B61">figure</span>(1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="autoExtrinsicFcn" id="F61N5:B65">subplot</span>(2,1,1) <span class="comment">% first subplot</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="autoExtrinsicFcn" id="F62N4:B71">plot</span>(<span class="var type1" id="S4T11U72">data</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">%filter parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">%pulse period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U42"><span class="var type1" id="S18T2U75">Tpprd</span> = <span class="mxinfo " id="T2:U44">0.1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">%clock period [usec]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T2:U45"><span class="var type1" id="S19T2U79">Tclk</span> = <span class="mxinfo " id="T2:U47">1./100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T2:U48"><span class="var type1" id="S20T2U85">Tclkn</span> = <span class="mxinfo " id="T2:U50"><span class="mxinfo " id="T2:U51"><span class="var type1" id="S19T2U87">Tclk</span></span>*<span class="mxinfo " id="T2:U53">1e-6</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">%high pass filter differentiation constant</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T2:U54"><span class="var type1" id="S21T2U91">Taud</span> = <span class="mxinfo " id="T2:U56">3.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T2:U57"><span class="var type1" id="S22T2U95">Taupk</span> = <span class="mxinfo " id="T2:U59">0.01</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T2:U60"><span class="var type1" id="S23T2U99">Taupk_top</span> = <span class="mxinfo " id="T2:U62">50</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="comment">%val=Tclk/Taud;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T2:U63"><span class="var type1" id="S24T2U103">val</span>=<span class="mxinfo " id="T2:U65"><span class="mxinfo " id="T2:U66">1</span>/<span class="var type1" id="S13T2U106">M</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T2:U68"><span class="var type1" id="S25T2U109">b10</span> = <span class="mxinfo " id="T2:U70">exp(<span class="mxinfo " id="T2:U71">-<span class="var type1" id="S24T2U113">val</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T2:U73"><span class="var type1" id="S27T2U116">na</span> = (<span class="mxinfo " id="T2:U75"><span class="mxinfo " id="T2:U76"><span class="var type1" id="S22T2U119">Taupk</span></span>/<span class="mxinfo " id="T2:U78"><span class="var type1" id="S19T2U120">Tclk</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T2:U80"><span class="var type1" id="S28T2U123">nad</span> = <span class="mxinfo " id="T2:U82"><span class="var type1" id="S27T2U125">na</span>-<span class="mxinfo " id="T2:U84">3</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T2:U85"><span class="var type1" id="S29T2U129">nb</span> = <span class="mxinfo " id="T2:U87">(<span class="mxinfo " id="T2:U88"><span class="var type1" id="S23T2U133">Taupk_top</span>+<span class="var type1" id="S22T2U134">Taupk</span></span>)/<span class="mxinfo " id="T2:U91"><span class="var type1" id="S19T2U135">Tclk</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T2:U93"><span class="var type1" id="S30T2U138">nbd</span> = <span class="mxinfo " id="T2:U95"><span class="var type1" id="S29T2U140">nb</span>-<span class="mxinfo " id="T2:U97">3</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="var type0" id="S31T0U144">z</span> = <span class="message error" id="M1F1C">tf(<span class="mxinfo " id="T25:U98"><span class="string">'z'</span></span>, <span class="var type1" id="S19T2U148">Tclk</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="comment">% Trapezoidal filter Z-transfer function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="var type0" id="S33T0U151">A</span>=(<span class="mxinfo " id="T2:U100">1</span>-<span class="var type1" id="S25T2U156">b10</span>*<span class="var type0" id="S31T0U158"><span class="message error" id="M2F1C">z</span></span>^-1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="var type0" id="S34T0U163">B</span>=( (<span class="mxinfo " id="T2:U102">1</span>-<span class="var type0" id="S31T0U170"><span class="message error" id="M3F1C">z</span></span>^-<span class="var type0" id="S27T0U172">na</span>)/(1-<span class="var type0" id="S31T0U177">z</span>^-1));</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="var type0" id="S35T0U182">AB</span>=<span class="var type0" id="S33T0U184"><span class="message error" id="M4F1C">A</span></span>*<span class="var type0" id="S34T0U185">B</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="var type0" id="S36T0U188">C</span>=( (<span class="mxinfo " id="T2:U103">1</span>-<span class="var type0" id="S31T0U195"><span class="message error" id="M5F1C">z</span></span>^-<span class="var type0" id="S29T0U197">nb</span>)/(1-<span class="var type0" id="S31T0U202">z</span>^-1));</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="var type0" id="S37T0U207">ABC</span>=<span class="var type0" id="S33T0U210"><span class="message error" id="M6F1C">A</span></span>*<span class="var type0" id="S34T0U211">B</span>*<span class="var type0" id="S36T0U212">C</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="var type0" id="S3T0U215">D</span>=<span class="var type0" id="S31T0U218"><span class="message error" id="M7F1C">z</span></span>^-1/<span class="var type0" id="S27T0U221">na</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="var type0" id="S38T0U224">hz1</span>=<span class="var type0" id="S33T0U228"><span class="message error" id="M8F1C">A</span></span>*<span class="var type0" id="S34T0U229">B</span>*<span class="var type0" id="S36T0U230">C</span>*<span class="var type0" id="S3T0U231">D</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">[<span class="var type0" id="S39T0U235"><span class="message error" id="M10F1C">hznum1</span></span>, <span class="var type0" id="S40T0U236"><span class="message error" id="M11F1C">hzden1</span></span>, <span class="var type0" id="S41T0U237"><span class="message error" id="M12F1C">Ts1</span></span>] = tfdata(<span class="var type0" id="S38T0U240"><span class="message error" id="M9F1C">hz1</span></span>,<span class="string">'v'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="var type0" id="S2T0U244">xf1</span>=filter(<span class="var type0" id="S39T0U247"><span class="message error" id="M13F1C">hznum1</span></span>,<span class="var type0" id="S40T0U248">hzden1</span>,<span class="var type0" id="S4T0U249">data</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="autoExtrinsicFcn" id="F65N5:B252">subplot</span>(2,1,2) <span class="comment">% second subplot</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">plot(<span class="var type0" id="S2T0U259"><span class="message error" id="M14F1C">xf1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"></span></span>
</pre>
